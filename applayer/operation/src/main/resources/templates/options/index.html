<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="decorator/layout">

<body>
<div class="content" layout:fragment="content">
    <div class="card">
        <div class="content">
            <div class="row">
                <form class="form-horizontal">

                    <div class="col-md-2">
                        <div class="form-group">
                            <label class="col-md-4 control-label">手机号</label>
                            <div class="col-md-8">
                                <input type="text" name="publisherPhone" class="form-control" maxlength="11"
                                       placeholder="手机号"/>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <div class="form-group">
                            <label class="col-md-4 control-label">订单编号</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="tradeNo" maxlength="20"
                                       placeholder="订单编号"/>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <div class="form-group">
                            <label class="col-md-4 control-label">订单状态</label>
                            <div class="col-sm-8">
                                <select class="form-control" name="state">
                                    <option value="0">所有订单</option>
                                    <option value="1">待确认</option>
                                    <option value="2">申购失败</option>
                                    <option value="3">持仓中</option>
                                    <option value="4">申请行权</option>
                                    <option value="5">结算中</option>
                                    <option value="6">已结算</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="col-md-2 control-label">日期</label>
                            <div class="col-md-5">
                                <input type="text" class="form-control datetimepicker" maxlength="11"
                                       placeholder="开始日期" name="beginTime"/>
                            </div>
                            <label></label>
                            <div class="col-md-5">
                                <input type="text" class="form-control datetimepicker" maxlength="11"
                                       placeholder="结束日期" name="endTime"/>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-1">
                        <div class="form-group">
                            <label class="col-md-5"></label>
                            <input type="button" class="btn btn-fill btn-info" value="搜索" id="search"/>
                        </div>
                    </div>
                    <div class="col-md-1">
                        <div class="form-group">
                            <label class="col-md-1"></label>
                            <input id="reset" type="button" class="btn btn-fill btn-info" value="清空"/>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <!-- 询价 -->
    <div class="modal fade" id="inquiry" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel2">
                        询价
                    </h4>
                </div>
                <div class="modal-body">
                    <form role="form">
                        <div class="form-group">
                            <label>询价日期:</label>
                            <input name="inquiryDate" type="text" class="form-control datetimepicker" maxlength="11"
                                   placeholder="询价日期"/>
                            <label>标的股票:</label>
                            <input name="stockName" type="text" class="form-control"
                                   placeholder="标的股票"/>
                            <label>期限:</label>
                            <input name="date" type="text" class="form-control"
                                   placeholder="期限"/>
                            <label>执行价:</label>
                            <select class="form-control">
                                <option value="100%">100%</option>
                            </select>
                            <label>结构:</label>
                            <select class="form-control">
                                <option>ATM</option>
                                <option>ITM</option>
                                <option>OTM</option>
                            </select>
                            <label>规模:</label>
                            <input name="inquiryamount" type="text" class="form-control"
                                   placeholder="请输入名称"/>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="inquiryclose" type="button" class="btn btn-default" data-dismiss="modal">关闭
                    </button>
                    <button id="inquiryaction" type="button" class="btn btn-primary">
                        确定
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>

    <!-- 申购 -->
    <!--<div class="modal fade" id="subscription" tabindex="-1" role="dialog" aria-labelledby="myModalLabel4"-->
         <!--aria-hidden="true">-->
        <!--<div class="modal-dialog">-->
            <!--<div class="modal-content">-->
                <!--<div class="modal-header">-->
                    <!--<button type="button" class="close" data-dismiss="modal" aria-hidden="true">-->
                        <!--&times;-->
                    <!--</button>-->
                    <!--<h4 class="modal-title" id="myModalLabel4">-->
                        <!--申购-->
                    <!--</h4>-->
                <!--</div>-->
                <!--<div class="modal-body">-->
                    <!--<h3>确定要申购?</h3>-->
                <!--</div>-->
                <!--<div class="modal-footer">-->
                    <!--<button type="button" class="btn btn-default" data-dismiss="modal" id="subscriptionclose">关闭-->
                    <!--</button>-->
                    <!--<button type="button" class="btn btn-primary" id="subscriptionaction">-->
                        <!--确定-->
                    <!--</button>-->
                <!--</div>-->
            <!--</div>&lt;!&ndash; /.modal-content &ndash;&gt;-->
        <!--</div>&lt;!&ndash; /.modal &ndash;&gt;-->
    <!--</div>-->

    <!-- 申购成功 -->
    <!--<div class="modal fade" id="subscriptionsuccess" tabindex="-1" role="dialog" aria-labelledby="myModalLabel5"-->
         <!--aria-hidden="true">-->
        <!--<div class="modal-dialog">-->
            <!--<div class="modal-content">-->
                <!--<div class="modal-header">-->
                    <!--<button type="button" class="close" data-dismiss="modal" aria-hidden="true">-->
                        <!--&times;-->
                    <!--</button>-->
                    <!--<h4 class="modal-title" id="myModalLabel5">-->
                        <!--申购成功-->
                    <!--</h4>-->
                <!--</div>-->
                <!--<div class="modal-body">-->
                    <!--<h3>确定申购成功?</h3>-->
                <!--</div>-->
                <!--<div class="modal-footer">-->
                    <!--<button type="button" class="btn btn-default" data-dismiss="modal" id="subscriptionsuccessclose">关闭-->
                    <!--</button>-->
                    <!--<button type="button" class="btn btn-primary" id="subscriptionsuccessaction">-->
                        <!--确定-->
                    <!--</button>-->
                <!--</div>-->
            <!--</div>&lt;!&ndash; /.modal-content &ndash;&gt;-->
        <!--</div>&lt;!&ndash; /.modal &ndash;&gt;-->
    <!--</div>-->

    <!-- 行权 -->
    <!--<div class="modal fade" id="exerciseright" tabindex="-1" role="dialog" aria-labelledby="myModalLabel6"-->
         <!--aria-hidden="true">-->
        <!--<div class="modal-dialog">-->
            <!--<div class="modal-content">-->
                <!--<div class="modal-header">-->
                    <!--<button type="button" class="close" data-dismiss="modal" aria-hidden="true">-->
                        <!--&times;-->
                    <!--</button>-->
                    <!--<h4 class="modal-title" id="myModalLabel6">-->
                        <!--行权-->
                    <!--</h4>-->
                <!--</div>-->
                <!--<div class="modal-body">-->
                    <!--<h3>确定行权?</h3>-->
                <!--</div>-->
                <!--<div class="modal-footer">-->
                    <!--<button type="button" class="btn btn-default" data-dismiss="modal" id="exerciserightclose">关闭-->
                    <!--</button>-->
                    <!--<button type="button" class="btn btn-primary" id="exerciserightaction">-->
                        <!--确定-->
                    <!--</button>-->
                <!--</div>-->
            <!--</div>&lt;!&ndash; /.modal-content &ndash;&gt;-->
        <!--</div>&lt;!&ndash; /.modal &ndash;&gt;-->
    <!--</div>-->
    <!-- 结算 -->
    <div class="modal fade" id="settlement" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabe">
                        结算
                    </h4>
                </div>
                <div class="modal-body">
                    <form role="form" action="http://www.baidu.com">
                        <form role="form">
                            <label>标的股票:</label>
                            <input type="text" class="form-control"
                                   placeholder="标的股票" name="detailStock"/>
                            <label>实际买入价:</label>
                            <input type="text" class="form-control"
                                   placeholder="实际买入价" name="detailAmount"/>
                            <label>名义本金:</label>
                            <input type="text" class="form-control"
                                   placeholder="名义本金" name="detailnominalAmount"/>
                            <label>实际卖出价:</label>
                            <input type="text" class="form-control"
                                   placeholder="实际卖出价" name="detailSellAmount"/>
                            <label>行权周期:</label>
                            <input type="text" class="form-control" name="detailCycleName"
                                   placeholder="行权周期"/>
                            <label>权利金:</label>
                            <input type="text" class="form-control" name="detailNominalAmount"
                                   placeholder="权利金"/>
                            <label>买入方式:</label>
                            <input type="text" class="form-control" name="detailBuyType"
                                   placeholder="买入方式"/>
                            <label>盈利:</label>
                            <input type="text" class="form-control" name="detailProfit"
                                   placeholder="盈利"/>
                        </form>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" id="settlementclose">关闭
                    </button>
                    <button type="button" class="btn btn-primary" id="settlementaction">
                        确定
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>

    <!-- 详情 -->
    <div class="modal fade" id="detail" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1" aria-hidden="true">
        <div class="modal-dialog" style="width: 700px">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel1">
                        详情
                    </h4>
                </div>
                <div class="modal-body">
                    <form role="form">
                        <label>标的股票:</label>
                        <input type="text" class="form-control"
                               placeholder="标的股票" name="detailStock"/>
                        <label>实际买入价:</label>
                        <input type="text" class="form-control"
                               placeholder="实际买入价" name="detailAmount"/>
                        <label>名义本金:</label>
                        <input type="text" class="form-control"
                               placeholder="名义本金" name="detailnominalAmount"/>
                        <label>实际卖出价:</label>
                        <input type="text" class="form-control"
                               placeholder="实际卖出价" name="detailSellAmount"/>
                        <label>行权周期:</label>
                        <input type="text" class="form-control" name="detailCycleName"
                               placeholder="行权周期"/>
                        <label>权利金:</label>
                        <input type="text" class="form-control" name="detailNominalAmount"
                               placeholder="权利金"/>
                        <label>买入方式:</label>
                        <input type="text" class="form-control" name="detailBuyType"
                               placeholder="买入方式"/>
                        <label>盈利:</label>
                        <input type="text" class="form-control" name="detailProfit"
                               placeholder="盈利"/>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" id="detailclose">关闭
                    </button>
                    <button type="button" class="btn btn-primary" id="detailaction">
                        确定
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>

    <!-- 机构信息 -->
    <div class="modal fade" id="orgdetail" tabindex="-1" role="dialog" aria-labelledby="myModalLabel3"
         aria-hidden="true">
        <span id="id" hidden="hidden"></span>
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabe3">
                        机构详情
                    </h4>
                </div>
                <div class="modal-body">
                    <div>
                        <form role="form" id="orgPriceAction">
                                <h5>机构报价单</h5>
                            <div class="panel-body ">
                                <table style="width: 90%;height: 90%;border-spacing:0 10px;border-collapse:separate;">
                                    <tr>
                                        <td><p>机构名称:</p></td>
                                        <td>
                                            <select name="orgId" style="margin-right: 10px">
                                            <option th:each="org:${orgVo}" th:value="${org.id}" th:text="${org.name}"></option>
                                         </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><p>机构报价:</p></td>
                                        <td>
                                            <input name="rightMoneyRatio" type="text" class="form-control "
                                                   placeholder="机构报价"/>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div align="center">
                                <button type="button" class="btn btn-primary" id="orgPrice">
                                    保存
                                </button>
                            </div>

                        </form>
                        <h5 class="page-header"></h5>
                        <form role="form" id="realPriceAction">
                                <h5>机构申报单</h5>
                            <div class="panel-body ">
                                <table style="width: 90%;height: 90%;border-spacing:0px 10px;border-collapse:separate;">
                                    <tr>
                                        <td><p>机构名称:</p></td>
                                        <td>
                                            <select name="orgId" style="margin-right: 10px">
                                                <option th:each="org:${orgVo}" th:value="${org.id}" th:text="${org.name}"></option>
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><p>申购实际报价:</p></td>
                                        <td>
                                            <input name="realRightMoneyRatio" type="text" class="form-control "
                                                   placeholder="申购实际报价"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><p>实际成交价格:</p></td>
                                        <td>
                                            <input name="realBuyingPrice" type="text" class="form-control "
                                                   placeholder="实际成交价格"/>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div align="center">
                                <button type="button" class="btn btn-primary" id="realPrice">
                                    保存
                                </button>
                            </div>
                        </form>
                        <h5 class="page-header "></h5>
                        <form role="form" id="orgSettleAction">
                                <h5>机构清算单</h5>

                            <div class="panel-body ">
                                <table style="width: 90%;height: 90%;border-spacing:0px 10px;border-collapse:separate;">
                                    <tr>
                                        <td><p>卖出价(元):</p></td>
                                        <td>
                                            <input name="sellingPrice" type="text" class="form-control"
                                                   placeholder="卖出价"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><p>平台盈亏:</p></td>
                                        <td>
                                            <p id="sys_profitAndLoss"></p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><p>用户盈亏:</p></td>
                                        <td>
                                            <p id="user_profitAndLoss"></p>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div align="center">
                                <button type="button" class="btn btn-primary" id="orgSettle">
                                    保存
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="orgClose" class="btn btn-default" data-dismiss="modal">关闭
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>


    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div>

                </div>
                <table id="bootstrap-table" class="table text-center">
                    <thead>

                    </thead>
                </table>

            </div>
            <!--  end card  -->
        </div>
        <!-- end col-md-12 -->
    </div>
    <!-- end row -->
    <script th:src="@{/static/js/jquery.min.js}" type="text/javascript"></script>
    <script th:src="@{/static/js/bootstrap-table.js}" type="text/javascript"></script>
    <script th:src="@{/static/js/bootstrap-table-zh-CN.js}" type="text/javascript"></script>

    <script type="text/javascript" >
        //<![CDATA[
        var $table = $('#bootstrap-table');
        $(function () {
            $table.bootstrapTable({
                url: "../option/pages",
                dataType: "json",
                cache: true, // 不缓存
                striped: true, // 隔行加亮
                pagination: true, // 开启分页功能
                search: false, // 开启搜索功能
                showColumns: true, // 开启自定义列显示功能
                showRefresh: true, // 开启刷新功能
                pageSize: 10, //每页的记录行数（*）
                minimumCountColumns: 1, // 设置最少显示列个数
                clickToSelect: true, // 单击行即可以选中
                uniqueId: "id", //每一行的唯一标识，一般为主键列
                sortName: 'updateTime', // 设置默认排序为 name
                sortOrder: 'desc', // 设置排序为反序 desc
                pageList: [10, 15, 20, 25, 30],
                sidePagination: "server",
                queryParams: function () {
                    var query = {
                        page: this.pageNumber - 1,
                        size: this.pageSize
                    }
                    var queryMap = {
                        publisherPhone: $("input[name='publisherPhone']").val(),
                        tradeNo: $("input[name='tradeNo']").val(),
                        state: $("[name='state']").val() == '0' ? "" : $("[name='state']").val(),
                        beginTime: $("[name='beginTime']").val(),
                        endTime: $("[name='endTime']").val(),
                    }
                    $.extend(query, queryMap);
                    return query;
                },
                responseHandler: function (res) {
                    if (res.code == '200') {
                        return {
                            total: res.result.totalElements,
                            rows: res.result.content
                        }
                    } else {
                        return {
                            total: 0,
                            rows: []
                        }
                    }
                },
                columns: [{
                    checkbox: true,
                    align: 'center'
                }, {
                    field: 'publisherPhone',
                    title: '手机号',
                    align: 'center'
                }, {
                    field: 'stockName',
                    title: '标的股票',
                    align: 'center'
                }, {
                    field: 'nominalAmount',
                    title: '名义本金',
                    align: 'center'
                }, {
                    field: 'rightMoney',
                    title: '预询价',
                    align: 'center'
                }, {
                    field: 'buyingPrice',
                    title: '成交价',
                    align: 'center'
                }, {
                    field: 'sellingPrice',
                    title: '实成价',
                    align: 'center'
                }, {
                    field: 'cycleName',
                    title: '行权周期',
                    align: 'center'
                }, {
                    field: 'buyingType',
                    title: '买入方式',
                    align: 'center'
                }, {
                    field: 'state',
                    title: '订单状态',
                    align: 'center',
                }, {
                    field: 'tradeNo',
                    title: '订单编号',
                    align: 'center'
                }, {
                    field: 'updateTime',
                    title: '交易时间',
                    align: 'center'
                }, {
                    title: '操作',
                    align: 'center',
                    formatter: function operateFormatter(value, row, index) {
                        if(row.state=="待确认"){
                            return [
                                ' <input type="button" value="询价" data-toggle="modal" data-target="#inquiry" class="btn btn-info btn-xs inquiry"/>\n' +
                                '<input type="button" value="申购" data-toggle="modal" data-target="#subscription" class="btn btn-info btn-xs subscription"/>\n' +
                                '<input type="button" value="申购成功" data-toggle="modal"  data-target="#subscriptionsuccess" class="btn btn-info btn-xs subscriptionsuccess"/>\n' +
                                '<input type="button" value="撤单" data-toggle="modal"  data-target="#subscriptionfail" class="btn btn-info btn-xs subscriptionfail"/>\n' +
                                '<input type="button" value="行权" data-toggle="modal"  data-target="#exerciseright" class="btn btn-info btn-xs exerciseright" disabled="disabled"/>\n' +
                                '<input type="button" value="结算" data-toggle="modal" data-target="#settlement" class="btn btn-info btn-xs settlement" disabled="disabled"/>\n' +
                                '<input type="button" value="详情" data-toggle="modal" data-target="#detail" class="btn btn-info btn-xs detail"/>\n' +
                                '<input type="button" value="机构信息" data-toggle="modal" data-target="#orgdetail" class="btn btn-info btn-xs orgdetail"/>'
                            ].join('');
                        }
                        if(row.state=="持仓中"){
                            return [
                                ' <input type="button" value="询价" data-toggle="modal" data-target="#inquiry" class="btn btn-info btn-xs inquiry" disabled="disabled"/>\n' +
                                '<input type="button" value="申购" data-toggle="modal" data-target="#subscription" class="btn btn-info btn-xs subscription" disabled="disabled"/>\n' +
                                '<input type="button" value="申购成功" data-toggle="modal"  data-target="#subscriptionsuccess" class="btn btn-info btn-xs subscriptionsuccess" disabled="disabled"/>\n' +
                                '<input type="button" value="撤单" data-toggle="modal"  data-target="#subscriptionfail" class="btn btn-info btn-xs subscriptionfail" disabled="disabled"/>\n' +
                                '<input type="button" value="行权" data-toggle="modal"  data-target="#exerciseright" class="btn btn-info btn-xs exerciseright" disabled="disabled"/>\n' +
                                '<input type="button" value="结算" data-toggle="modal" data-target="#settlement" class="btn btn-info btn-xs settlement" disabled="disabled"/>\n' +
                                '<input type="button" value="详情" data-toggle="modal" data-target="#detail" class="btn btn-info btn-xs detail"/>\n' +
                                '<input type="button" value="机构信息" data-toggle="modal" data-target="#orgdetail" class="btn btn-info btn-xs orgdetail"/>'
                            ].join('');
                        }
                        if(row.state=="申请行权"){
                            return [
                                ' <input type="button" value="询价" data-toggle="modal" data-target="#inquiry" class="btn btn-info btn-xs inquiry" disabled="disabled"/>\n' +
                                '<input type="button" value="申购" data-toggle="modal" data-target="#subscription" class="btn btn-info btn-xs subscription" disabled="disabled"/>\n' +
                                '<input type="button" value="申购成功" data-toggle="modal"  data-target="#subscriptionsuccess" class="btn btn-info btn-xs subscriptionsuccess" disabled="disabled"/>\n' +
                                '<input type="button" value="撤单" data-toggle="modal"  data-target="#subscriptionfail" class="btn btn-info btn-xs subscriptionfail" disabled="disabled"/>\n' +
                                '<input type="button" value="行权" data-toggle="modal"  data-target="#exerciseright" class="btn btn-info btn-xs exerciseright"/>\n' +
                                '<input type="button" value="结算" data-toggle="modal" data-target="#settlement" class="btn btn-info btn-xs settlement"/>\n' +
                                '<input type="button" value="详情" data-toggle="modal" data-target="#detail" class="btn btn-info btn-xs detail"/>\n' +
                                '<input type="button" value="机构信息" data-toggle="modal" data-target="#orgdetail" class="btn btn-info btn-xs orgdetail"/>'
                            ].join('');
                        }
                        if(row.state=="结算中"&&row.rightTime==null){
                            return [
                                ' <input type="button" value="询价" data-toggle="modal" data-target="#inquiry" class="btn btn-info btn-xs inquiry" disabled="disabled"/>\n' +
                                '<input type="button" value="申购" data-toggle="modal" data-target="#subscription" class="btn btn-info btn-xs subscription" disabled="disabled"/>\n' +
                                '<input type="button" value="申购成功" data-toggle="modal"  data-target="#subscriptionsuccess" class="btn btn-info btn-xs subscriptionsuccess" disabled="disabled"/>\n' +
                                '<input type="button" value="撤单" data-toggle="modal"  data-target="#subscriptionfail" class="btn btn-info btn-xs subscriptionfail" disabled="disabled"/>\n' +
                                '<input type="button" value="行权" data-toggle="modal"  data-target="#exerciseright" class="btn btn-info btn-xs exerciseright"/>\n' +
                                '<input type="button" value="结算" data-toggle="modal" data-target="#settlement" class="btn btn-info btn-xs settlement"/>\n' +
                                '<input type="button" value="详情" data-toggle="modal" data-target="#detail" class="btn btn-info btn-xs detail"/>\n' +
                                '<input type="button" value="机构信息" data-toggle="modal" data-target="#orgdetail" class="btn btn-info btn-xs orgdetail"/>'
                            ].join('');
                        }
                        if(row.state=="结算中"&&row.rightTime!=null){
                            return [
                                ' <input type="button" value="询价" data-toggle="modal" data-target="#inquiry" class="btn btn-info btn-xs inquiry" disabled="disabled"/>\n' +
                                '<input type="button" value="申购" data-toggle="modal" data-target="#subscription" class="btn btn-info btn-xs subscription" disabled="disabled"/>\n' +
                                '<input type="button" value="申购成功" data-toggle="modal"  data-target="#subscriptionsuccess" class="btn btn-info btn-xs subscriptionsuccess" disabled="disabled"/>\n' +
                                '<input type="button" value="撤单" data-toggle="modal"  data-target="#subscriptionfail" class="btn btn-info btn-xs subscriptionfail" disabled="disabled"/>\n' +
                                '<input type="button" value="行权" data-toggle="modal"  data-target="#exerciseright" class="btn btn-info btn-xs exerciseright" disabled="disabled"/>\n' +
                                '<input type="button" value="结算" data-toggle="modal" data-target="#settlement" class="btn btn-info btn-xs settlement"/>\n' +
                                '<input type="button" value="详情" data-toggle="modal" data-target="#detail" class="btn btn-info btn-xs detail"/>\n' +
                                '<input type="button" value="机构信息" data-toggle="modal" data-target="#orgdetail" class="btn btn-info btn-xs orgdetail"/>'
                            ].join('');
                        }

                        if(row.state=="已结算"){
                            return [
                                ' <input type="button" value="询价" data-toggle="modal" data-target="#inquiry" class="btn btn-info btn-xs inquiry" disabled="disabled"/>\n' +
                                '<input type="button" value="申购" data-toggle="modal" data-target="#subscription" class="btn btn-info btn-xs subscription" disabled="disabled"/>\n' +
                                '<input type="button" value="申购成功" data-toggle="modal"  data-target="#subscriptionsuccess" class="btn btn-info btn-xs subscriptionsuccess" disabled="disabled"/>\n' +
                                '<input type="button" value="撤单" data-toggle="modal"  data-target="#subscriptionfail" class="btn btn-info btn-xs subscriptionfail" disabled="disabled"/>\n' +
                                '<input type="button" value="行权" data-toggle="modal"  data-target="#exerciseright" class="btn btn-info btn-xs exerciseright" disabled="disabled"/>\n' +
                                '<input type="button" value="结算" data-toggle="modal" data-target="#settlement" class="btn btn-info btn-xs settlement" disabled="disabled"/>\n' +
                                '<input type="button" value="详情" data-toggle="modal" data-target="#detail" class="btn btn-info btn-xs detail"/>\n' +
                                '<input type="button" value="机构信息" data-toggle="modal" data-target="#orgdetail" class="btn btn-info btn-xs orgdetail" disabled="disabled"/>'
                            ].join('');
                        }else{
                            return [
                                ' <input type="button" value="询价" data-toggle="modal" data-target="#inquiry" class="btn btn-info btn-xs inquiry" disabled="disabled"/>\n' +
                                '<input type="button" value="申购" data-toggle="modal" data-target="#subscription" class="btn btn-info btn-xs subscription" disabled="disabled"/>\n' +
                                '<input type="button" value="申购成功" data-toggle="modal"  data-target="#subscriptionsuccess" class="btn btn-info btn-xs subscriptionsuccess" disabled="disabled"/>\n' +
                                '<input type="button" value="撤单" data-toggle="modal"  data-target="#subscriptionfail" class="btn btn-info btn-xs subscriptionfail" disabled="disabled"/>\n' +
                                '<input type="button" value="行权" data-toggle="modal"  data-target="#exerciseright" class="btn btn-info btn-xs exerciseright" disabled="disabled"/>\n' +
                                '<input type="button" value="结算" data-toggle="modal" data-target="#settlement" class="btn btn-info btn-xs settlement" disabled="disabled"/>\n' +
                                '<input type="button" value="详情" data-toggle="modal" data-target="#detail" class="btn btn-info btn-xs detail" />\n' +
                                '<input type="button" value="机构信息" data-toggle="modal" data-target="#orgdetail" class="btn btn-info btn-xs orgdetail" disabled="disabled"/>'
                            ].join('');
                        }
                    },
                    events: {
                        'click .inquiry': function (e, value, row, index) {
                            $("[name='inquiryDate']").val(new Date());
                            $("[name='stockName']").val(row.stockName);
                            $("[name='date']").val(row.cycle + "日");
                            $("[name='inquiryamount']").val(row.nominalAmount);
                            $('#inquiryaction').click(function () {
                                $('#inquiryclose').click();
                                $.ajax({
                                    url: "../option/inquiry/" + row.id,
                                    type: 'post',
                                    success: function (response) {
                                        if (response.code = '200') {
                                            $table.bootstrapTable('refresh');
                                            alert("询价成功");
                                        } else {
                                            alert(response.message);
                                        }
                                    },
                                    error: function () {
                                        alert("询价失败")
                                    }
                                })
                                modal.find('#inquiry').attr("onclick",params[0]);
                            })
//                            $(location).prop('href', "../option/inquiry/" + row.id);
                        },
                        'click .subscription': function (e, value, row, index) {
//                            $('#subscriptionaction').click(function () {
//                                $('#subscriptionclose').click();
//                                $.ajax({
//                                    url: "../option/purchase/" + row.id,
//                                    type: 'post',
//                                    success: function (response) {
//                                        if (response.code = '200') {
//                                            $table.bootstrapTable('refresh');
//                                            alert("申购成功");
//                                        } else {
//                                            alert("申购失败");
//                                        }
//                                    },
//                                    error: function () {
//                                        alert("申购失败");
//                                    }
//                                })
//                                modal.find('#subscription').attr("onclick",params[0]);
//                            })
                            swal({
                                title: "你确定吗?",
                                text: "申购后,数据将不可被恢复!",
                                type: "warning",
                                showCancelButton: true,
                                confirmButtonText: "是的, 申购!",
                                cancelButtonText: "不了, 取消!",
                                closeOnConfirm: false,
                                closeOnCancel: false
                            }, function(isConfirm) {
                                if (isConfirm) {
                                    $.ajax({
                                        url: "../option/purchase/" + row.id,
                                        type: 'post',
                                        success: function (response) {
                                            if (response.code = '200') {
                                                $table.bootstrapTable('refresh');
                                                swal("申购成功！");
                                            } else {
                                                swal("申购失败！");
                                            }
                                        },
                                        error: function () {
                                            swal("申购失败！");
                                        }
                                    })
                                } else {
                                    swal("已取消申购！");
                                }
                            });
//                            $(location).prop('href', "../stock/edit/" + row.id);
                        },
                        'click .subscriptionsuccess': function (e, value, row, index) {
//                            $('#subscriptionsuccessaction').click(function () {
//                                $('#subscriptionsuccessclose').click();
//                                $.ajax({
//                                    url: "../option/success/" + row.id,
//                                    type: 'post',
//                                    success: function (response) {
//                                        if (response.code = '200') {
//                                            $table.bootstrapTable('refresh');
//                                            alert("订单状态修改成功");
//                                        } else {
//                                            alert(response.message);
//                                        }
//                                    },
//                                    error: function () {
//                                        alert("订单修改失败")
//                                    }
//                                })
//                                modal.find('#subscriptionsuccess').attr("onclick",params[0]);
//                            })
//                            $(location).prop('href', "../stock/edit/" + row.id);
                            swal({
                                title: "你确定吗?",
                                text: "申购成功后,数据将不可被恢复!",
                                type: "warning",
                                showCancelButton: true,
                                confirmButtonText: "是的, 申购!",
                                cancelButtonText: "不了, 取消!",
                                closeOnConfirm: false,
                                closeOnCancel: false
                            }, function(isConfirm) {
                                if (isConfirm) {
                                    $.ajax({
                                        url: "../option/success/" + row.id,
                                        type: 'post',
                                        success: function (response) {
                                            if (response.code = '200') {
                                                $table.bootstrapTable('refresh');
                                                swal("申购成功！");
                                            } else {
                                                swal(response.message);
                                            }
                                        },
                                        error: function () {
                                            swal("申购失败！")
                                        }
                                    })
                                } else {
                                    swal("已取消申购成功操作！");
                                }
                            });
                        },
                        'click .subscriptionfail': function (e, value, row, index) {
                            swal({
                                title: "你确定吗?",
                                text: "撤单成功后,数据将不可被恢复!",
                                type: "warning",
                                showCancelButton: true,
                                confirmButtonText: "是的, 撤单!",
                                cancelButtonText: "不了, 取消!",
                                closeOnConfirm: false,
                                closeOnCancel: false
                            }, function(isConfirm) {
                                if (isConfirm) {
                                    $.ajax({
                                        url: "../option/fail/" + row.id,
                                        type: 'post',
                                        success: function (response) {
                                            if (response.code = '200') {
                                                $table.bootstrapTable('refresh');
                                                swal("撤单成功！");
                                            } else {
                                                swal(response.message);
                                            }
                                        },
                                        error: function () {
                                            swal("撤单失败！")
                                        }
                                    })
                                } else {
                                    swal("已取消撤单操作！");
                                }
                            });
                        },
                        'click .exerciseright': function (e, value, row, index) {
//                            $('#exerciserightaction').click(function () {
//                                $('#exerciserightclose').click();
//                                $.ajax({
//                                    url: "../option/exercise/" + row.id,
//                                    type: 'post',
//                                    success: function (response) {
//                                        if (response.code = '200') {
//                                            $table.bootstrapTable('refresh');
//                                            alert("行权成功");
//                                        } else {
//                                            alert(response.message);
//                                        }
//                                    },
//                                    error: function () {
//                                        alert("行权失败");
//                                    }
//                                })
//                                modal.find('#exerciseright').attr("onclick",params[0]);
//                            })
//                            $(location).prop('href', "../stock/edit/" + row.id);
                            swal({
                                title: "你确定吗?",
                                text: "行权后,数据将不可被恢复!",
                                type: "warning",
                                showCancelButton: true,
                                confirmButtonText: "是的, 行权!",
                                cancelButtonText: "不了, 取消!",
                                closeOnConfirm: false,
                                closeOnCancel: false
                            }, function(isConfirm) {
                                if (isConfirm) {
                                    $.ajax({
                                        url: "../option/exercise/" + row.id,
                                        type: 'post',
                                        success: function (response) {
                                            if (response.code = '200') {
                                                $table.bootstrapTable('refresh');
                                                swal("行权成功");
                                            } else {
                                                swal(response.message);
                                            }
                                        },
                                        error: function () {
                                            swal("行权失败");
                                        }
                                    })
                                } else {
                                    swal("已取消行权操作！");
                                }
                            });
                        },
                        'click .settlement': function (e, value, row, index) {
                            var sellingPrice = row.offlineTrade.sellingPrice;
                            if(sellingPrice==null||sellingPrice=='') {
                                sellingPrice = 0;
                                profitAndLoss = 0;
                            }else {
                                var buyingPrice = row.buyingPrice;
                                var nominalAmount = row.nominalAmount;
                                var profitAndLoss  = ((sellingPrice-buyingPrice)/buyingPrice)*nominalAmount;
                                if(profitAndLoss>0) {
                                    profitAndLoss = profitAndLoss.toFixed(2) + "";
                                    var flag = profitAndLoss.indexOf(".");
                                    if(flag!=-1) {
                                        profitAndLoss = profitAndLoss.substring(0,flag+3);
                                    }
                                }else {
                                    profitAndLoss = 0;
                                }
                            }

                            $("[name='detailStock']").val(row.stockName);
                            $("[name='detailAmount']").val(row.buyingPrice);
                            $("[name='detailnominalAmount']").val(row.nominalAmount);
                            $("[name='detailSellAmount']").val(sellingPrice);
                            $("[name='detailCycleName']").val(row.cycleName);
                            $("[name='detailNominalAmount']").val(row.rightMoney);
                            $("[name='detailBuyType']").val(row.buyingType);
                            $("[name='detailProfit']").val(profitAndLoss);
                            $('#settlementaction').click(function () {
                                $('#settlementclose').click();
                                $.ajax({
                                    url: "../option/settlement/"+row.id,
                                    type: 'post',
                                    success: function (response) {
                                        if (response.code = '200') {
                                            $table.bootstrapTable('refresh');
                                            alert("结算成功");
                                        } else {
                                            alert(response.message);
                                        }
                                    },
                                    error: function () {
                                        alert("结算失败")
                                    }
                                })
                                modal.find('#settlement').attr("onclick",params[0]);
                            })
//                            $(location).prop('href', "../option/inquiry/" + row.id);
                        },
                        'click .detail': function (e, value, row, index) {
                            $("[name='detailStock']").val(row.stockName);
                            $("[name='detailAmount']").val(row.buyingPrice);
                            $("[name='detailnominalAmount']").val(row.nominalAmount);
                            $("[name='detailSellAmount']").val(row.sellingPrice);
                            $("[name='detailCycleName']").val(row.cycleName);
                            $("[name='detailNominalAmount']").val(row.rightMoney);
                            $("[name='detailBuyType']").val(row.buyingType);
                            $("[name='detailProfit']").val(row.profit);
                            $('#detailaction').click(function () {
                                $('#detailclose').click();

                            })
//                            $(location).prop('href', "../option/inquiry/" + row.id);
                        },
                        'click .orgdetail': function (e, value, row, index) {
                            $("#id").val(row.id);
                            $('#orgPrice').click(function () {
                                $('#orgClose').click();
                                var patt = /^(1|1\.[0]*|0?\.(?!0+$)[\d]+)$/;
                                if(!patt.test($("[name='rightMoneyRatio']").val())) {
                                    alert("数据格式错误，请重新输入！");
                                }else {
                                    $.ajax({
                                        url: "../inquiryresult/add",
                                        type: 'get',
                                        data: {"trade.id": row.id,"rightMoneyRatio":$("[name='rightMoneyRatio']").val(),"org.id":$("[name='orgId']").val()},
                                        success: function (response) {
                                            if (response.code = '200') {
                                                $table.bootstrapTable('refresh');
                                                alert("保存成功");
                                            } else {
                                                alert(response.message);
                                            }
                                            $("[name='rightMoneyRatio']").val('');
                                        },
                                        error: function () {
                                            alert("保存失败")
                                            $("[name='rightMoneyRatio']").val('');
                                        }
                                    })
                                }
                                modal.find('#orgdetail').attr("onclick",params[0]);
                            })
                            $('#realPrice').click(function () {
                                $('#orgClose').click();
                                $.ajax({
                                    url: "../offlinestockoptiontrade/add",
                                    type: 'get',
                                    data: {"id": row.id,"rightMoneyRatio":$("[name='realRightMoneyRatio']").val(),"buyingPrice":$("[name='realBuyingPrice']").val(),"org.id":$("[name='orgId']").val()},
                                    success: function (response) {
                                        if (response.code = '200') {
                                            $table.bootstrapTable('refresh');
                                            alert("保存成功");
                                        } else {
                                            alert(response.message);
                                        }
                                        $("[name='realRightMoneyRatio']").val('');
                                        $("[name='realBuyingPrice']").val('');
                                    },
                                    error: function () {
                                        alert("保存失败")
                                        $("[name='realRightMoneyRatio']").val('');
                                        $("[name='realBuyingPrice']").val('');
                                    }
                                })
                            })
                            $('#orgSettle').click(function () {
                                $('#orgClose').click();
                                $.ajax({
                                    url: "../offlinestockoptiontrade/settlement/" + $("[name='sellingPrice']").val()+"/"+row.id,
                                    type: 'get',
                                    success: function (response) {
                                        if (response.code = '200') {
                                            $table.bootstrapTable('refresh');
                                            alert("保存成功");
                                        } else {
                                            alert(response.message);
                                        }
                                        $("[name='sellingPrice']").val('');
                                    },
                                    error: function () {
                                        alert("保存失败")
                                        $("[name='sellingPrice']").val('');
                                    }
                                })
                            })

                        },
                    }
                }],
                onLoadError: function (status) {
                    swal({
                        title: "数据加载异常.",
                        text: status + "",
                        timer: 2000,
                        showConfirmButton: false
                    });
                }
            });


            //activate the tooltips after the data table is initialized
            $('[rel="tooltip"]').tooltip();

            $(window).resize(function () {
                $table.bootstrapTable('resetView');
            });
            $('#search').click(function () {
                var stockName = $("input[name='publisherPhone']");
                var stockCode = $("input[name='tradeNo']");
                var status = $("[name='beginTime']");
                var beginTime = $("input[name='endTime']").val();
                var endTime = $("input[name='state']").val();
                if (stockName == "" && stockCode == "" && status == "") {
                    swal("请输入查询数据！");
                }
                $table.bootstrapTable('getOptions').pageNumber = 1;
                $table.bootstrapTable('refresh');
            });

            $('#reset').click(function () {
                $("input[name='publisherPhone']").val('');
                $("input[name='tradeNo']").val('');
                $("input[name='beginTime']").val('');
                $("input[name='endTime']").val('');
                $("[name='state']").val("0");
                $table.bootstrapTable('getOptions').pageNumber = 1;
                $table.bootstrapTable('refresh');
            });

            $("[name='sellingPrice']").blur(function() {
                $.ajax({
                    url: "../option/" + $("#id").val(),
                    type: 'get',
                    success: function (response) {
                        if (response.code = '200') {
                            var result = response.result;
                            var sellingPrice = $("[name='sellingPrice']").val();
                            var buyingPrice = result.buyingPrice;
                            var nominalAmount = result.nominalAmount;
                            var profitAndLoss  = ((sellingPrice-buyingPrice)/buyingPrice)*nominalAmount;
                            if(profitAndLoss>0) {
                                profitAndLoss = profitAndLoss.toFixed(2) + "";
                                var flag = profitAndLoss.indexOf(".");
                                if(flag!=-1) {
                                    profitAndLoss = profitAndLoss.substring(0,flag+3);
                                }
                                $("#user_profitAndLoss").text(profitAndLoss);
                            }else {
                                $("#user_profitAndLoss").text(0);
                            }
                            $("#sys_profitAndLoss").text(result.rightMoney);
                        } else {
                            swal(response.message);
                        }
                    }
                })
            })
        });
        //]]>
    </script>

</div>
</body>
</html>